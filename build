#!/bin/bash

# Clone the site repository if it's not there
if [ ! -d target ]; then
	git clone git+ssh://git@github.com/alexj136/alexj136.github.io.git target/
fi

# Pull down the stylesheet if it's not there
if [ ! -f target/style.css ]; then
	curl -o target/style.css https://raw.githubusercontent.com/sindresorhus/github-markdown-css/gh-pages/github-markdown.css
fi

# Build the content
for page in pages/*.md posts/*.md; do
    infile="${page##*/}"
    outfile="target/${infile%.md}.html"
    cat template/preamble.html > $outfile
	markdown template/header.md >> $outfile
	markdown $page >> $outfile
    cat template/postamble.html >> $outfile
done

# Copy the images directory
cp -ru images target/

# Copy the extras
for file in extra/*; do
    cp -ru $file target/
done
